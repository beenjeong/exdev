<!-- 
	- 사용 방법
	
	var parm = {
		 GRP_FILE_ID 	: [고유ID]
		,OWNER_CD 		: [사용Type ID]        						// => 공통 코드로 관리됨. GRP_CODE_ID = FILE_USE_TYPE
		,allowExt		: ["jpg", "jpeg", "png", "gif", "bmp"]		// => 사용 가능 확장자 설정 / 생략시 모두 허용
		,buttonName		: "이미지선택"								// => 나타나는 버튼 명 정의 / 생략시 파일선택이 기본으로 나타남 
	}
	
	
	
	C_COMP.import("importFilemng", "component_compFilemng",parm , function(fileId) {
		
	});
-->


<meta charset="utf-8">
<script type="text/javascript">
	var <@compId> = {
		 GRP_FILE_ID 	: ""
		,OWNER_CD 		: ""
		,allowExt		: []
		,filesArr		: []
		,uploadMultiFile : function () {
	
		    // 폼데이터 담기
		    var form = document.querySelector("#<@compId>_form");
		    
		    var formData = new FormData(form);
		    
		    formData.append("GRP_FILE_ID"	, <@compId>.GRP_FILE_ID	);
		    formData.append("OWNER_CD"		, <@compId>.OWNER_CD	);
		    
		    for (var i = 0; i < <@compId>.filesArr.length; i++) {
	            formData.append("attach_file"	, <@compId>.filesArr[i]);
	            formData.append("FILE_IDS"		, C_COM.makeUniqueId());
		    }
	
		    $.ajax({
		    	url: '/multiFileUpload.do',
		        method: 'POST',
		        data: formData,
		        contentType: false,
		        processData: false,
		        success: function (response) {
		        	const msg = response.msg;
		        	
		        	// 첨부 결과 File ID를 Import 대상으로 리턴한다.
		        	C_COMP.callback("<@compId>", response.list[0]);
		        },
		        error: function (xhr, desc, err) {
		            alert('에러가 발생 하였습니다.');
		            return;
		        }
		    })
		 }
		/* 첨부파일 추가 */
		,addFile : function(obj){
			debugger;
	        const file = obj.files[0];

	        // 첨부파일 검증
	        if (<@compId>.validation(file)) {
	            // 파일 배열에 담기
	            var reader = new FileReader();
	            reader.onload = function () {
	            	<@compId>.filesArr.push(file);
			    	<@compId>.uploadMultiFile();		    	
				    // 초기화
				    $("#<@compId> input[type=file]").val("");
	            };
	            reader.readAsDataURL(file)
	        } else {

	        }
		 }
		/* 첨부파일 검증 */
		,validation : function(obj){
		    const fileTypes = ['application/pdf', 'image/gif', 'image/jpeg', 'image/png', 'image/bmp', 'image/tif', 'application/haansofthwp', 'application/x-hwp'];
		    if (obj.name.length > 100) {
		        alert("파일명이 100자 이상인 파일은 선택 할 수 없습니다.");
		        return false;
		    } else if (obj.size > (20 * 1024 * 1024)) {
		        alert("최대 파일 용량인 20MB를 초과한 파일은 선택 할 수 없습니다.");
		        return false;
		    } else if (obj.name.lastIndexOf('.') == -1) {
		        alert("확장자가 없는 파일은 선택 할 수 없습니다.");
		        return false;
		    } else if (!fileTypes.includes(obj.type)) {
		        alert("첨부가 불가능한 파일은  선택 할 수 없습니다.");
		        return false;
		    } else {
		        return true;
		    }
		 }
		,selectFile : function() {
			$("#<@compId>_select").trigger("click");
		 }
	}
	// Component Load가 완료된후 실행 된다.
	C_COMP.onLoadComp("<@compId>", function(parm) {
		if(isEmpty(parm.GRP_FILE_ID)) {
			alert('<@compId> 를 Import할때 GRP_FILE_ID가 필요 합니다.');
			return;
		}
		if(isEmpty(parm.OWNER_CD)) {
			alert('<@compId> 를 Import할때 GRP_FILE_ID가 필요 합니다.');
			return;
		}
		<@compId>.GRP_FILE_ID 	= parm.GRP_FILE_ID	;
		<@compId>.OWNER_CD 		= parm.OWNER_CD		;
		
		if(parm.hide == 'Y') {
			$("#<@compId>_select").hide();
		}
		
		if(isValid(parm.buttonName)) {
			$("#<@compId> #buttonName").html(parm.buttonName);
		}
	});
</script>
<div>
	<button type="button" class="stateBtn file" onclick="<@compId>.selectFile()"><span id="buttonName">파일선택</span></button>
    <form method="POST" id="<@compId>_form" onsubmit="return false;" enctype="multipart/form-data">
        <input id="<@compId>_select" type="file" onchange="<@compId>.addFile(this);" style="display:none"/>
    </form>
</div>
