<meta charset="utf-8">
<script type="text/javascript">
 var <@popupId> = {
	rcvData : {}
 	,returnData : {}
 	,queryId : ''	
 	,targetId : ''	
    ,searchId : ''	
	,exceptMembers : []
    ,close : function(returnData) {
 
		if(isEmpty(returnData)) returnData = {};
		C_POP.close(returnData);
	}
	,searchList : function(){

		<@popupId>.searchId = $("[name='SEARCH_ID']").val();
		
		const requestParm = {SEARCH_ID: <@popupId>.searchId , EXCEPT_MEMERS : <@popupId>.exceptMembers};
		let parm = {
			queryId        : <@popupId>.queryId
			,requestParm    : requestParm
		}
        C_COM.requestQuery(parm, function(resultData) {
        
        	let rparm = {
           			targetId   : <@popupId>.targetId
					,list       : resultData.data
			}
            
			C_COM.renderHtml("<@popupId>", rparm);
			<@popupId>.setHandler();
		});
	}
	,setTitle : (gubun) => {

	   	$("#<@popupId> .tit").text		( gubun == "BUYER" ? "고객 선택"  : "사원 선택" 	);
	   	$("#<@popupId> ._search").text	( gubun == "BUYER" ? "고객 검색"  : "사원 검색"	);
	   	$("#<@popupId> ._list").text	( gubun == "BUYER" ? "고객 리스트": "사원 리스트");
     	
	}		
	,setHandler : () => {

 			$("tr[name^='<@pageId>_tr_']").off().on('dblclick',function() {

					let buyerId , buyerNm, address, userId, userNm = '';
					let grade, branchId, gradeNm,salesTypeCode, salesTypeCodeNm  = ''; 
	 	
					if( <@popupId>.rcvData.gubun == "BUYER"){
	 		
							buyerId	= $(this).find("#BUYER_ID"	).text();
					 		buyerNm	= $(this).find("#BUYER_NM"	).text();
					 		address	= $(this).find("#ADDR"		).text();
	 						<@popupId>.close({'BUYER_ID' : buyerId, 'BUYER_NM' : buyerNm
			 						 ,'ADDR' : address });
	 		
					}else{
							userId	= $(this).find("#USER_ID"	).text();
							userNm	= $(this).find("#USER_NM"	).text();
							address	= $(this).find("#ADDR"		).text();
							gradeNm	= $(this).find("#GRADE_NM"	).text();
							grade	= $(this).find("#GRADE"		).text();
							branchId= $(this).find("#BRANCH_ID"	).text();
							salesTypeCode	= $(this).find("#SALES_TYPE_CODE_ID").text();
							salesTypeCodeNm = $(this).find("#SALES_TYPE_CODE_NM").text();
	 						<@popupId>.close({'USER_ID'  : userId , 'USER_NM'  : userNm
			 						 ,'ADDR' : address , 'GRADE' :grade, 'GRADE_NM' : gradeNm, 'BRANCH_ID' : branchId
				 					 ,'SALES_TYPE_CODE_ID' : salesTypeCode, 'SALES_TYPE_CODE_NM' : salesTypeCodeNm});
					}
	 	
 			});
 			 
	}
	,nameSearch : (e) => {
		
		 if (e.key === "Enter") {

				<@popupId>.searchId = event.target.value;
				<@popupId>.searchList();
				
		}
	}
	
}
// Popup Load가 완료된후 실행 된다.
C_POP.onLoadPopup("<@popupId>", function(data) {
 	
		<@popupId>.rcvData 		= data;
		const searchText		= data.param.searchText;
		 $("[name='SEARCH_ID']").val(searchText)
		 
		if(data.param.ALL_MEMBERS){
			<@popupId>.exceptMembers= data.param.ALL_MEMBERS.map( member => member.USER_ID);
		}
 		
		if(data.gubun == "BUYER"){
			
			$("#<@popupId>_customer_list").show();
			$("#<@popupId>_user_list").hide();
			<@popupId>.queryId = "contract.getBuyerList";
			<@popupId>.targetId= "<@pageId>_cstmList"
			
		}else {
			
			$("#<@popupId>_user_list").show();
			$("#<@popupId>_customer_list").hide();
			<@popupId>.queryId = "contract.getUserList"
			<@popupId>.targetId= "<@pageId>_userList"
			
		}

		<@popupId>.setTitle(data.gubun);

		<@popupId>.searchList();

 });
    
    
</script>
   <!-- 고객 선택 팝업 -->
<div class="modal_wrap" id="<@popupId>">
	<div class="modal"  style="width:500px;height:610px;">
		<div class="modal_header">
               <strong class="tit">고객 선택/사원 선택</strong>
               <button type="button" class="btn_close" onclick="<@popupId>.close()"><span class="sp">팝업 닫기</span></button>
		</div>
		<div class="modal_body">
               <dl class="info_wrap pay">
                   <dt class="_search">고객 검색/사원 검색</dt>
                   <dd>
                       <div class="search_inputWrap" style="width:100%">
                        <input type="search" name="SEARCH_ID" onkeydown="<@popupId>.nameSearch(event)"><button class="search_btn" onclick="<@popupId>.searchList()"><i class="icon_search"></i></button>
                       </div>
                   </dd>
                   
                   <dt class="w100 pr0 _list">고객 리스트/사원 리스트</dt>
					<!-- 고객 리스트 -->
					<div class="tbl01 col" id="<@popupId>_customer_list" style="min-height:300px;max-height:300px;overflow:auto;">
					<table>
						<caption>고객 리스트</caption>
						<colgroup>
							<col style="width:20%;"/>
							<col style="width:40%;"/>
							<col style="width:40%;"/>
						</colgroup>
						<thead>
							<tr id="<@pageId>_headingColName">
								<th scope="col">고객번호</th>
								<th scope="col">고객명</th>
								<th scope="col">본점주소</th>
							</tr>
						</thead>
						<tbody  id="<@pageId>_cstmList">
						</tbody>
	<script type="text/x-jsrender" id="<@pageId>_cstmList_template">						
						{{for list}}
							<tr name="<@pageId>_tr_{{:#index}}" value='{{{:BUYER_ID}}'>
			 					<td id='BUYER_ID'		value='{{:BUYER_ID}}'		>{{:BUYER_ID}}</td>
			 					<td id='BUYER_NM'		value='{{:BUYER_NM}}'		>{{:BUYER_NM}}</td>
			 					<td id='ADDR'			value='{{:ADDR}}' style="text-align:left">{{:ADDR}}</td>
			 					<td id='DEL_YN'			value='{{:DEL_YN}}' 		style="display:none">{{:DEL_YN}}</td>
							</tr>
						{{/for}}
	</script>
	<script type="text/x-jsrender" id="<@pageId>_cstmList_noData_template">	
				<tr>	
					<td colspan=3>자료가 없습니다.</td>	
				</tr>
	</script>
					</table>
				</div>
			</dt>
			</dl>
			
					<!-- 사원 리스트 -->
				<div class="tbl01 col" id="<@popupId>_user_list" style="min-height:300px;max-height:300px;overflow:auto;">
					<table>
						<caption>사원 리스트</caption>
						<colgroup>
							<col style="width:25%;"/>
							<col style="width:25%;"/>
							<col style="width:25%;"/>
							<col style="width:25%;"/>
						</colgroup>
						<thead>
							<tr id="<@pageId>_headingColName">
								<th scope="col">사원ID</th>
								<th scope="col">사원이름</th>
								<th scope="col">등급</th>
								<th scope="col">영업구분</th>
							</tr>
						</thead>
						<tbody  id="<@pageId>_userList">
						</tbody>
	<script type="text/x-jsrender" id="<@pageId>_userList_template">						
						{{for list}}
							<tr name="<@pageId>_tr_{{:#index}}" value='{{{:USER_ID}}'>
			 					<td id='USER_ID'		value='{{:USER_ID}}'		>{{:USER_ID}}</td>
			 					<td id='USER_NM'		value='{{:USER_NM}}'		>{{:USER_NM}}</td>
			 					<td id='GRADE_NM'		value='{{:GRADE_NM}}'		>{{:GRADE_NM}}</td>
			 					<td id='SALES_TYPE_NM'  value='{{:SALES_TYPE_NM}}'  >{{:SALES_TYPE_NM}}</td>
			 					<td id='GRADE' 			value='{{:GRADE}}'			style="display:none">{{:GRADE}}</td>
			 					<td id='SALES_TYPE' 	value='{{:SALES_TYPE}}'		style="display:none">{{:SALES_TYPE}}</td>
			 					<td id='BRANCH_ID' 		value='{{:BRANCH_ID}}'		style="display:none">{{:BRANCH_ID}}</td>
							</tr>
						{{/for}}
	</script>
	<script type="text/x-jsrender" id="<@pageId>_userList_noData_template">	
				<tr>	
					<td colspan=3>자료가 없습니다.</td>	
				</tr>
	</script>
					</table>
				</div>
			</dt>
			</dl>
		</div>
		<div class="modal_footer">
		    <button type="button" class="btn close" onclick="<@popupId>.close()">닫기</button>
		</div>
	</div>
</div>