<meta charset="utf-8">
<script type="text/javascript">
    var <@pageId> = {
             approvalList : [] 
            ,excelParamGrp : {}
            ,searchApproval : () => {
            	    console.log("======= 부모창 searchApproval =======");
                    
                    let requestParm = {};
                    
                    //requestParm["spCstmId"]  = "1234567890123456";
                    //requestParm["searchUserId"]  = "trigger7kr";
                    requestParm["state"]  = "REQUEST";
                    
                    let parm = {
                         queryId        : "approval.getApproval"
                        ,requestParm    : requestParm
                    }
                    
                    <@pageId>.excelParamGrp= parm;
                    
                    C_COM.requestQuery(parm, function(resultData) {
                        console.log( resultData.data);
                        <@pageId>.approvalList = resultData.data;
                        let rparm = {
                                 targetId   : "tableId"
                                ,list       : resultData.data
                            }
                        C_COM.renderHtml("<@pageId>", rparm);
                        
                        <@pageId>.setHandler();//엑셀
                    });            
            }
              
            ,setHandler : () => {//엑셀
                 
                $("[name='<@pageId>_excelDownload']").off().on("click",function(){
                    console.log("_excelDownload");
                    const sectionId = $(this).closest("section").attr("id");
                    <@pageId>.excelDownload(sectionId,"상신함 목록");
                })
            }       
            ,excelDownload : (sectionId,title) => {
            	console.log("excelDownload sectionId ==>"+sectionId);
                let excelParam = {};
                excelParam = <@pageId>.excelParamGrp

                console.log("excelDownload  excelParam ===="+excelParam);
                const $hds = $("#"+sectionId + " #<@pageId>_headingColName th");
                const $tds = $("#"+sectionId + " [name='<@pageId>_tr_0'] td");

                console.log("sectionId  ===="+sectionId);
                _excelDownload($hds, $tds, excelParam, title );
                
            }
            ,apprDtlPopup : function(approvalId) {    
                console.log("======= apprDtlPopup approvalId =======>"+approvalId);
                let requestParm = {}
                requestParm["approvalId"] = approvalId;
                C_POP.open('popup_apprDtlPopup', requestParm, function() {
                    //console.log("======= 부모창 retData =======");
                });
             }
            ,apprReqPopup : function() {    
                console.log("======= apprReqPopup =======>");
                let requestParm = {}
                C_POP.open('popup_apprReqPopup', requestParm, function() {
                    console.log("======= 부모창 retData =======");
                    <@pageId>.searchApproval();
                });
                
             }

            ,fileDownload : function(uuid) {    
                console.log("======= fileDownload uuid =======>"+uuid);
                
                let formData = new FormData();
                formData.append('uuid', uuid);
                
                $.ajax({
                    url: "/fileDownload.do",
                    type: "POST",
                    success: function(response){
                        // 파일 다운로드 성공시 처리
                        console.log("======= 파일 다운로드 성공시 처리 =======>");
                    },
                    error: function(xhr, status, error){
                        // 에러 처리
                        console.error(error);
                    }
                })
                
             }  
    }
    // Page Load가 완료된후 실행 된다.
    C_PM.onLoadPage("<@pageId>", function() {
        <@pageId>.searchApproval();

        //조회 버튼 클릭      
        $('#<@pageId>_apprReqPopupBtn').on('click', function (e) {
            <@pageId>.apprReqPopup();
        })
        
        
    });
    // History back으로 이동해왔을 경우 이루틴이 실행된다.
    C_HM.onReturn("<@pageId>", function(pageId, data) {

    });
</script>
        <div class="cont_wrap">
            <div class="cont_top">
                <h2><i class="icon_bullet"></i>상신함</h2>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button id='<@pageId>_apprReqPopupBtn' type="button" class="btn select" >결재 상신</button>
            </div>
            <div class="sec_scroll">
                <section class="sec_wrap" id="<@pageId>_apprList_section">
                    <div class="cont_box">
                        <h3>상신함 목록</h3>
                        <!-- search area -->
                        <div class="search_area">
                            <span class="tit01">조회기간</span>
                            <div class="calendar_wrap">
                                <input type="text" class="datepicker" style="width:132px">
                            </div>
                            <div class="search_right">
                                <button type="button" class="btn fl" name="<@pageId>_excelDownload"><i class="icon_download"></i> Excel 다운로드</button>
                                <div class="select_box fl" style="width:132px">
                                    <button type="button" class="btn radio"><span>50개 보기</span></button>
                                    <ul class="select_lst">
                                        <li>
                                            <input name="number" id="num01" type="radio" value="">
                                            <label for="num01">50개 보기<i class="icon_check"></i></label>
                                        </li>
                                        <li>
                                            <input name="number" id="num02" type="radio" value="">
                                            <label for="num02">30개 보기<i class="icon_check"></i></label>
                                        </li>
                                        <li>
                                            <input name="number" id="num03" type="radio" value="">
                                            <label for="num03">10개 보기<i class="icon_check"></i></label>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>


                        <!-- 테이블 -->
                        <div class="tbl01 col mt15">
                            <table>
                                <caption>표 캡션</caption>
                                <colgroup>
                                    <col style="width:50px;"/>
                                    <col style="width:130px;"/>
                                    <col style="width:*"/>
                                    <col style="width:100px;"/>
                                </colgroup>
                                <thead>
                                    <tr id="<@pageId>_headingColName">
                                        <th scope="col">Num</th>
                                        <th scope="col">상신일</th>
                                        <th scope="col">제목</th>
                                        <th scope="col">상태</th>
                                    </tr>
                                </thead>
                                <tbody id="tableId">
                                </tbody>
                                <script type="text/x-jsrender" id="tableId_template">    
                                    {{for list}}
                                        <tr id="trId_{{:#index}}" name="<@pageId>_tr_{{:#index}}" value='{{:APPROVAL_ID}}'>
                                            <td id='ROWNUM'          value='{{:ROWNUM}}'         >{{:ROWNUM}}    </td>
                                            <td id='APPROVAL_DATE1'  value='{{:APPROVAL_DATE1}}' >{{:APPROVAL_DATE1}}</td>
                                            <td id='TITLE'           value='{{:TITLE}}'         class="tl"><a href="javascript:void(0);" onclick="<@pageId>.apprDtlPopup('{{:APPROVAL_ID}}');">{{:TITLE}}</a></td>
                                            <td id='STATE'           value='{{:STATE}}'          ><span class="state paying">{{:STATE}}</span></td>
                                        </tr>
                                    {{/for}}
                                </script>
                                <script type="text/x-jsrender" id="tableId_noData_template">    
                                   <tr>    
                                       <td colspan=4>자료가 없습니다.</td>    
                                   </tr>
                                </script>
                            </table>
                        </div>
                        <!-- paging -->
                        <div class="paging">
                            <a href="#none" class="btn_pg_first disabled">첫번째 페이지</a>
                            <a href="#none" class="btn_pg_prev disabled">이전 페이지</a>
                            <strong title="현재 페이지">1</strong>
                            <a href="#none">2</a>
                            <a href="#none">3</a>
                            <a href="#none">4</a>
                            <a href="#none">5</a>
                            <a href="#none" class="btn_pg_next">다음 페이지</a>
                            <a href="#none" class="btn_pg_last">마지막 페이지</a>
                        </div>
                    </div>
                </section>
            </div>
        </div>