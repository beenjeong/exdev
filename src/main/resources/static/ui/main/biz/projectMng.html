<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		 projectList : []
		,openProjectPopup : function() {
			C_POP.open('popup_operation_projectRegistPopup', {}, function(retData) {
				if(retData.reload == 'Y') {
					<@pageId>.loadData();
				}
			});
		 }
		,loadData : function() {
			var parm = {
				 queryId 		: "contract.getProjectList"
				,requestParm	: {}
			}
			C_COM.requestQuery(parm, function(resultData) {
				
				<@pageId>.projectList = resultData.data;
				
				$.each(<@pageId>.projectList, function(idx) {
					if(isEmpty(this.APP_STATE_NM)) <@pageId>.projectList[idx].APP_STATE_NM = "";
				});
				
				var rparm = {
						 targetId 		: "<@pageId>_projectList"
						,list			: resultData.data
						,targetTotalId	: "<@pageId>_totalCnt"
				}
				C_COM.renderHtml("<@pageId>", rparm);
			});  
				
		 }
		,modify	: function(index) {
			let projectItem = <@pageId>.projectList[index];
			
			C_POP.open('popup_operation_projectRegistPopup', {mode : 'M', projectItem : projectItem }, function(retData) {
				if(retData.reload == 'Y') {
					<@pageId>.loadData();
				}
			});
		 }
		,approval : function(idx) {

			let CONTRACT_ID = <@pageId>.projectList[idx].CONTRACT_ID;
			
			alert(CONTRACT_ID);
			
	        let requestParm = {APPROVAL_ID : CONTRACT_ID}
	        C_POP.open('popup_appr_apprReqPopup', requestParm, function() {

	        });
		 }
	}
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function() {
		<@pageId>.loadData();
	});
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
</script>
		<div class="cont_wrap backWhite">
			<div class="cont_top">
				<h2><i class="icon_bullet"></i>프로젝트 관리</h2>
			</div>
			<section class="sec_wrap list" style="height:calc(100% - 43px);">
				<!-- search area -->
				<div class="search_area mt0">
					<div class="fl">
						<button class="btn select fl" onclick="<@pageId>.openProjectPopup()">프로젝트 추가</button>
		            </div>
		            <div class="search_right">
						<strong class="total">Total: <span class="pointColr" id="<@pageId>_totalCnt">0</span></strong>
		            </div>
				</div>
				<!-- 테이블 -->
				<div class="tbl01 col tbl_scroll" style="max-height:506px;">
					<div class="tbl01 col tbl_head">
						<table>
							<caption>프로젝트 리스트</caption>
							<colgroup>
								<col style="width:40px;"/>
								<col style="width:150px;"/>
								<col style="width:150px;"/>
								<col style="width:*"/>
								<col style="width:150px;"/>
								<col style="width:200px;"/>
								<col style="width:70px;"/>
								<col style="width:150px;"/>
							</colgroup>
							<thead>
								<tr>
									<th scope="col">No.</th>
									<th scope="col">고객명</th>
									<th scope="col">영업담당자명</th>
									<th scope="col">상품명</th>
									<th scope="col">상태</th>
									<th scope="col">등록/수정일</th>
									<th scope="col">결재</th>
									<th scope="col"><i class="icon_pen"></i> &nbsp;&nbsp; <i class="icon_trash"></i></th>
								</tr>
							</thead>
						</table>
					</div>
					<div class="tbl01 col tbl_body_scroll">
						<table>
							<caption>프로젝트 리스트 Body</caption>
							<colgroup>
								<col style="width:40px;"/>
								<col style="width:150px;"/>
								<col style="width:150px;"/>
								<col style="width:*"/>
								<col style="width:150px;"/>
								<col style="width:200px;"/>
								<col style="width:70px;"/>
								<col style="width:150px;"/>
							</colgroup>
							<tbody id="<@pageId>_projectList">
							</tbody>
							<script type="text/x-jsrender" id="<@pageId>_projectList_template">						
								{{for list}}
								<tr>
									<td>{{:#index + 1}}</td>
									<td>{{:BUYER_NM}}</td>
									<td>{{:USER_NM}}</td>
									<td>{{:CONSULTING_NM}}</td>
									<td>{{:PROCESS_STATE_NM}}</td>
									<td>{{:UPDATE_DATE}}{{:#index}}</td>
									<td>
									{{if APP_STATE_NM=="" ~index=#index}} 
										<button type="button" class="btn fl tc" onclick="<@pageId>.approval({{:~index}})">결재</button>
									{{else}}
										{{:APP_STATE_NM}}	
									{{/if}}
									</td>
									<td>
										<button onclick="<@pageId>.modify({{:#index}})"><i class="icon_pen"		></i></button>	&nbsp; 
										<button onclick="<@pageId>.delete({{:#index}})"><i class="icon_trash"	></i></button>
									</td>
								</tr>
								{{/for}}
							</script>
							<script type="text/x-jsrender" id="<@pageId>_projectList_noData_template">	
								<tr>	
									<td colspan=9>자료가 없습니다.</td>	
								</tr>
							</script>
						</table>
					</div>
				</div>
			</section>
		</div>
