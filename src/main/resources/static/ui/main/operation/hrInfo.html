<meta charset="utf-8">
<script type="text/javascript">
var <@pageId> = {
		
		pageInit : () =>{
		}
		,setSpCstmId : (dataList) =>{
			if( dataList && dataList.length > 0 && G_VAL.SP_CSTM_ID=="")G_VAL.SP_CSTM_ID = dataList[0].SP_CSTM_ID;
		}
		,searchList : () => {
			
			const requestParm = {};
			
			var parm = {
					 queryId 		: "hrInfo.getHrInfoList"
					,requestParm	: requestParm
			}
			
			C_COM.requestQuery(parm, function(resultData) {
			
				<@pageId>.setSpCstmId(resultData.data);
				var rparm = {
						 targetId 		: "<@pageId>_hiInfoList"
						,list			: resultData.data
				}
				
			
				C_COM.renderHtml("<@pageId>", rparm);

//				<@pageId>.setHandler();
			});
			
		}
		,updateItem : (param) => {

			const requestParm = param ? param : {} ;
			requestParm["SP_CSTM_ID"] = G_VAL.SP_CSTM_ID;
			if( !requestParm["USER_ID"] || requestParm["USER_ID"] == ''){
				requestParm["USER_ID"] = C_COM.makeUniqueId();
			}
			
			var parm = {
					queryGroup : [
						 {
							 queryId 		: "system.updateUser"
							,requestParm	: requestParm
						 }
						,{
							 queryId 		: "system.updateAuth"
							,requestParm	: requestParm
						 }
					]
				}			
				C_COM.requestQuery(parm, function(resultData) {

						if( resultData.state == "S"){

							console.log( " "+ resultData.data["system.updateUser"] )
							console.log( " "+ resultData.data["system.updateAuth"] )
							
							<@pageId>.searchList();
							console.log("Item 저장 성공");
						
						}else{
							alert(resultData.msg)
						}
				});				
			
		} 
		,deleteItem : (delKey) => {
			
			var parm = {
					 queryId 		: "system.deleteUser"
					,requestParm	: {"SP_CSTM_ID":delKey.SP_CSTM_ID
									  ,"USER_ID":delKey.USER_ID}
			}
			C_COM.requestQuery(parm, function(resultData) {
				if( resultData.state == 'S'){
					<@pageId>.searchList();
					console.log("Item 삭제 성공")
				}				
			});				
		}
		, deleteOne : (key) =>{
			
    		const SP_CSTM_ID 	= key.split("||")[0];
    		const USER_ID 		= key.split("||")[1];
    		<@pageId>.deleteItem({SP_CSTM_ID:SP_CSTM_ID,USER_ID:USER_ID})
    		
		}
		,setHandler : () => {
			
			<@pageId>.chkHandler();
		    
		    $("#<@pageId>_insert").click(function(){
		    	
				<@pageId>.openPopup();

		    })
		    
		    $("#<@pageId>_delete").click(function(){
		    	
		    	<@pageId>.checkedItems.forEach( key =>{
					<@pageId>.deleteOne(key);
		    	})
		    	
		    })
		    
		    $("#<@pageId>_excelDownload").click(function(){
		    	
		    	<@pageId>.excelDownload("TBL_EXP_USER");
		    	
		    })
		    
		    $("[id^='<@pageId>_modify_']").click(function(){
		    	
		    	const index = $(this).attr("index");
				const $tds = $("[name='<@pageId>_tr_"+index+"'] td");
				<@pageId>.openPopup($tds);
				
		    })
		    
		    $("[id^='<@pageId>_delete_']").click(function(){

		    	const key = $(this).attr("key");
				<@pageId>.deleteOne(key);
				
		    })
		    
			$("#<@pageId>_search").click( () =>{
		    	<@pageId>.searchList();
		    })
		    
		}
		,chkHandler : () => {
			
		    $("#<@pageId>_ckAll").click(function() {

		    	const isAllChk =  $(this).prop("checked");
				$("[id^='<@pageId>_ck_']").prop("checked", isAllChk);
				
		    	const ckboxes = $("[id^='<@pageId>_ck_']");
			    <@pageId>.checkedItems = isAllChk ? ckboxes.map(function() { return this.value; }).get() : [];

		    });
		    $("[id^='<@pageId>_ck_']").click(function(){
		    	
			        if ($(this).prop("checked")){<@pageId>.checkedItems.push($(this).val());}
		    	else { <@pageId>.checkedItems = <@pageId>.checkedItems.filter(item => item !== $(this).val());}  
		        
		        const $checkboxSelector = $("[id^='<@pageId>_ck_']")
		        const allCheckboxChecked = $checkboxSelector.length === $checkboxSelector.filter(":checked").length;
		        $("#<@pageId>_ckAll").prop("checked", allCheckboxChecked);
		        
		    });
		    
		}		
		,openPopup : ($tds) => {

			let param = [];	
			$.each( $tds , function(){
				console.log(""+this)
				const key = $(this).attr("id");
				const val = $(this).attr("value");
				param.push( { "key": key, "val": val } );
				
			})
			C_POP.open('popup_hrInfoUpdatePopup', {param:param}, function(retData) {
				
				if(isValid(retData)){
					//<@pageId>.updateItem(retData);
				}
			});
			
		}		
}

// Page Load가 완료된후 실행 된다.
C_PM.onLoadPage("<@pageId>", function() {

	<@pageId>.pageInit();
	<@pageId>.setHandler();
	<@pageId>.searchList();

});
// History back으로 이동해왔을 경우 이루틴이 실행된다.
C_HM.onReturn("<@pageId>", function(pageId, data) {

});
</script>
<div class="cont_wrap">

		<div class="cont_top">
			<h2><i class="icon_bullet"></i>인사정보</h2>
		</div>
	
		<section class="sec_wrap list" style="height:calc(100% - 43px);">
			<!-- search area -->
			<div class="search_area mt0">
				<!-- 멀티 선택 -->
				<div class="fl">
					<div class="dropdown fl" style="width:200px;">
						<button type="button" class="btn arrow">
							<span class="hida">Select</span>
							<p class="multiSel"></p>
						</button>
					    <div class="mutliSelect">
					    </div>
					</div>
					<div class="search_inputWrap">
						<input type="search" name=""><button class="search_btn"><i class="icon_search"></i></button>
					</div>
				</div>
	
				<div class="search_right">
					<button type="button" class="btn select fl" id="<@pageId>_insert"><i class="icon_user_plus"></i>신규 직원 추가</button>
					<button type="button" class="btn fl" id="<@pageId>_excelDownload_all"><i class="icon_download"></i> 직원 리스트 다운로드</button>
					<button type="button" class="btn fl" id="<@pageId>_excelDownload_select"><i class="icon_download"></i> 선택 직원 다운로드</button>
	
					<!-- 실글 선택 -->
					<div class="select_box fl" style="width:132px">
						<button type="button" class="btn radio"><span>50개 보기</span></button>
<!-- 	                    <ul class="select_lst">
	                        <li>
	                            <input name="number" id="num01" type="radio" value="">
	                            <label for="num01">50개 보기<i class="icon_check"></i></label>
	                        </li>
	                        <li>
	                            <input name="number" id="num02" type="radio" value="">
	                            <label for="num02">30개 보기<i class="icon_check"></i></label>
	                        </li>
	                        <li>
	                            <input name="number" id="num03" type="radio" value="">
	                            <label for="num03">10개 보기<i class="icon_check"></i></label>
	                        </li>
	                    </ul> -->
	                </div>
	            </div>
			</div>
			<!-- 테이블 -->
			<div class="tbl01 col tbl_scroll" style="max-height:506px;">
				<div class="tbl01 col tbl_head">
					<table>
						<caption>인사정보 리스트</caption>
						<colgroup>
							<col style="width:40px;"/>
							<col style="width:120px;">
							<col style="width:80px;"/>
							<col style="width:160px;"/>
							<col style="width:110px;"/>
							<col style="width:80px;" span="3"/>
							<col style="width:100px;" span="2"/>
							<col style="width:80px;"/>
							<col style="width:100px;"/>
							<col style="width:120px;" span="3"/>
							<col style="width:120px;"/>
						</colgroup>
						<thead>
							<tr>
								<th scope="col"><input type="checkbox"></th>
								<th scope="col">사원번호</th>
								<th scope="col">성명</th>
								<th scope="col">이메일주소</th>
								<th scope="col">연락처</th>
								<th scope="col">본부</th>
								<th scope="col">지사명</th>
								<th scope="col">지점명</th>
								<th scope="col">역할</th>
								<th scope="col">등급</th>
								<th scope="col">상태</th>
								<th scope="col">보증보험<br>가입금액</th>
								<th scope="col">보증보험<br>가입일</th>
								<th scope="col">보증보험<br>만기일</th>
								<th scope="col">입사일</th>
								<th scope="col">미스터승격일</th>
							</tr>
						</thead>
					</table>
				</div>
				<div class="tbl01 col tbl_body_scroll">
					<table>
						<colgroup>
							<col style="width:40px;"/>
							<col style="width:120px;">
							<col style="width:80px;"/>
							<col style="width:160px;"/>
							<col style="width:110px;"/>
							<col style="width:80px;" span="3"/>
							<col style="width:100px;" span="2"/>
							<col style="width:80px;"/>
							<col style="width:100px;"/>
							<col style="width:120px;" span="3"/>
							<col style="width:120px;"/>
						</colgroup>
						<tbody  id="<@pageId>_hiInfoList">
						</tbody>
<script type="text/x-jsrender" id="<@pageId>_hiInfoList_template">						
						{{for list}}
							<tr name="<@pageId>_tr_{{:#index}}"                          value='{{:SP_CSTM_ID}}||{{:USER_ID}}'>
								<td><input type='checkbox' id="<@pageId>_ck_{{:#index}}" value='{{:SP_CSTM_ID}}||{{:USER_ID}}'></td>
			 					<td id='USER_ID'		value='{{:USER_ID}}'		>{{:USER_ID}}</td>
			 					<td id='USER_NM'		value='{{:USER_NM}}'		><a href="personnel_info_view.html">{{:USER_NM}}</a></td>
			 					<td id='E_MAIL'			value='{{:E_MAIL}}'			>{{:E_MAIL}}</td>
			 					<td id='PHONE_NUM'		value='{{:PHONE_NUM}}'		>{{:PHONE_NUM}}</td>
								<td>본사</td>
								<td>일산</td>
								<td>스타</td>
								<td id='ROLE'			value='{{:ROLE}}'			style='display:none'></td>
								<td id='ROLE_DESC'		value='{{:ROLE_DESC}}'	 	>{{:ROLE_DESC}}</td>
								<td id='GRADE'			value='{{:GRADE}}'			style='display:none'></td>
								<td id='GRADE_DESC'		value='{{:GRADE_DESC}}'	 	>{{:GRADE_DESC}}</td>
								<td id='STATE'			value='{{:STATE}}'			style='display:none'></td>
								<td id='STATE_DESC'		value='{{:STATE_DESC}}'	 	>사용</td>
								<td>2000</td>
								<td>2023.08.17</td>
								<td>2024.08.17</td>
								<td>2013.08.17</td>
								<td>2014.08.17</td>
							</tr>
						{{/for}}
</script>
<script type="text/x-jsrender" id="<@pageId>_hiInfoList_noData_template">	
				<tr>	
					<td colspan=16>자료가 없습니다.</td>	
				</tr>
</script>
					</table>
				</div>
			</div>
			<!-- paging -->
			<div class="paging">
				<a href="#none" class="btn_pg_first disabled">첫번째 페이지</a>
				<a href="#none" class="btn_pg_prev disabled">이전 페이지</a>
				<strong title="현재 페이지">1</strong>
				<a href="#none">2</a>
				<a href="#none">3</a>
				<a href="#none">4</a>
				<a href="#none">5</a>
				<a href="#none" class="btn_pg_next">다음 페이지</a>
				<a href="#none" class="btn_pg_last">마지막 페이지</a>
			</div>
		</section>
	
	</div>
</div>