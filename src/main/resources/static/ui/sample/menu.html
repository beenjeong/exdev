<meta charset="utf-8">
<script type="text/javascript">
var <@pageId> = {
		
		 menuList : []	
		,selectedCheck : []
		,getItems : () => {
			
				const requestParm = {};
				const updateItems = $("#<@pageId>_updateItems input:not([type='radio'])");
				
				const valuesArray = updateItems.map(function() {
					
					if( this.name == "MENU_ID" && this.value =="" )this.value = C_COM.makeUniqueId();
				    return { name: this.name, value: ""+$(this).val() };
				}).get();
				
				valuesArray.forEach(function(item) {
					requestParm[item.name] = item.value;
				});
				
				const radioName = 'USE_YN';
				requestParm[radioName] = <@pageId>.fnRadioCheckValue(radioName);

				requestParm['PARENT_MENU_ID'] = $("#<@pageId>_updateItems select").val();
				if(requestParm['PARENT_MENU_ID'] == "null" || requestParm['PARENT_MENU_ID'] == "-1")requestParm['PARENT_MENU_ID']=null;
				return requestParm;
		}
		,adminMenu : () => {
			

				var parm = {
					 queryId 		: "admin.getMenuList"
					,requestParm	: <@pageId>.getItems()
				}
				C_COM.requestQuery(parm, function(resultData) {

					<@pageId>.menuList = resultData.data;
					
					var rparm = {
							 targetId 		: "menuList"
							,list			: resultData.data
						}
				
					C_COM.renderHtml("<@pageId>", rparm);
					
					<@pageId>.itemReset();
					
  					$("#PARENT_MENU_ID option").remove();
  					const parentOption = resultData.data.filter( option => option.MENU_DEPTH == 0);
  					$("#PARENT_MENU_ID").append("<option value='-1'>Select Parent</option>");
  					parentOption.forEach(menu => {
  						$("#PARENT_MENU_ID").append("<option value='" + menu.MENU_ID + "'>" + menu.MENU_DESC + "</option>");
  					});
					
					<@pageId>.setHandler();
				});
								
		}
		,updateMenu : () => {

				var parm = {
						 queryId 		: "admin.updateMenu"
						,requestParm	: <@pageId>.getItems()
				}
				C_COM.requestQuery(parm, function(resultData) {
					
					if( resultData.state == 'S'){
						<@pageId>.adminMenu();
						console.log("메뉴 저장 성공");
					}				
				});
		}  
		,deleteMenu : (item) => {
				
				var parm = {
						 queryId 		: "admin.deleteMenu"
						,requestParm	: {"MENU_ID":item}
				}
				C_COM.requestQuery(parm, function(resultData) {
					if( resultData.state == 'S'){
						<@pageId>.adminMenu();
						console.log("메뉴 삭제 성공")
					}				
				});				
		}  
		,setHandler : () => {
				
   				$("[id^='<@pageId>.ck_']").on('change', function () {

					const checkedCheckboxes = $("[id^='<@pageId>.ck_']:checked");
					if( checkedCheckboxes && checkedCheckboxes.length>0){
				        <@pageId>.selectedCheck = [];
				        checkedCheckboxes.each(function() {
				            <@pageId>.selectedCheck.push($(this).val());
				        });
					}
				})   
				 
		        $("#menuList").on('click', 'tr', function () {
		        	
		            const rowId = $(this)[0].id;
		            if (rowId) {
		            	
	            		$($("#menuList>#"+rowId+" td")).each( (idx,td) => {
	            			
	            			<@pageId>.setEachColumnValue(td)
	            		})
		            }
	
		            const parentMenuSelect = $("select[name='PARENT_MENU_ID']");
	            	parentMenuSelect.prop("disabled", $("#<@pageId>_updateItems input[name='MENU_DEPTH']").val() == "0");
	            	
	            	$('#<@pageId>_insertMenu').hide();
		        });		

   			    $("select[name='PARENT_MENU_ID']").on('change', function() {

   			        const selectedValue = $(this).val();
   			        console.log("Selected PARENT_MENU_ID value: " + selectedValue);
   			        
   			     	<@pageId>.menuList.forEach( menu => {
   			     		if( menu.MENU_ID == selectedValue){

   			     			const menuDept = Number(menu.MENU_DEPTH) + 1;
   			     			$("#<@pageId>_updateItems input[name='MENU_DEPTH']").val(menuDept);
   			     		}
   			     	})
   			    });  		

   			    $("#<@pageId>_reset").on('click', function() {
   			    	
   			    	<@pageId>.itemReset();
   			    	$('#<@pageId>_insertMenu').show();
   			    });   				
   				
		}
		, itemReset : () => {
			
				$("#<@pageId>_updateItems input:not([type='radio'])").each( (idx, obj) => {
						$(obj).val("");
				}); 

				<@pageId>.fnRadioCheckValue("USE_YN","");
				$("select[name='PARENT_MENU_ID']").val("");
				
		}
		,fnRadioCheckValue : (name , pValue) => {

				const radioButtons = $("#<@pageId>_updateItems input[name='"+name+"']");
				if( pValue ){
				 
					const theRadioBtn = radioButtons.filter("[value='"+pValue+"']");
					 theRadioBtn.prop('checked',true);
				}else{
				
					const selectedValue = radioButtons.filter(":checked").val();
					return selectedValue;
				 }
		}
		,setEachColumnValue : (td) => {
			
				const name 	= td.getAttribute("id");
				const value = td.getAttribute("value");
				
				if( name == "PARENT_MENU_ID" ){
						
					$("select[name='PARENT_MENU_ID']").val(value);
					
				}else if( name == "USE_YN" ){
					
					<@pageId>.fnRadioCheckValue('USE_YN',value);
				
				}else{
				
					$("#<@pageId>_updateItems input").each((idx,obj)=>{
						if(obj.name == name){
							obj.value = value;
						}
					})
				}
		}
		,validation : (gubun) => {
			
				if( gubun == "updateMenu"){
					const menuId = $("#<@pageId>_updateItems input[name='MENU_NM']").val();
					if( isEmpty(menuId)){
						alert("저장할 데이터를 확인하여 주십시오.");
					}
					return isEmpty(menuId) ? false:true;
				}
				if( gubun == "deleteMenu"){
					const deleItemsCnt = <@pageId>.selectedCheck.length;
					if( deleItemsCnt == 0 ){
						alert("삭제할 데이터를 확인하여 주십시오.")
					}
					return deleItemsCnt == 0 ? false:true;
				}
		}

}

// Page Load가 완료된후 실행 된다.
C_PM.onLoadPage("<@pageId>", function(parm) {

		<@pageId>.adminMenu();
			
		$('#<@pageId>_insertMenu,#<@pageId>_saveMenu').on('click', function (e) {
			
			if(<@pageId>.validation("updateMenu")  == false)return;
			
			<@pageId>.updateMenu();
		})
		
		$('#<@pageId>_deleteMenu').on('click', function (e) {
		
			if(<@pageId>.validation("deleteMenu")  == false)return;

			<@pageId>.selectedCheck.forEach( item =>
				<@pageId>.deleteMenu(item)
			)
		}) 
		
		$('#<@pageId>_search').on('click', function (e) {
			
			<@pageId>.adminMenu();
		}) 
});
	
// History back으로 이동해왔을 경우 이루틴이 실행된다.
C_HM.onReturn("<@pageId>", function(pageId, data) {

});
</script>
<style>
    .side {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        border: 1px solid black;
    }

    button {
        margin-top: 10px;
        background-color: #555; 
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-left: 5px;
    }

    button:hover {
        background-color: #333; /* 더 어두운 회색 계열 */
    }

    .tb {
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .tb th, .tb td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }

    .tb th {
        background-color: #f2f2f2;
    }

    .tb tr:hover {
        background-color: #f5f5f5;
    }

    .side input,
    .side select,
    .side button {
        margin: 5px;
        padding: 8px;
    }

    .side select {
        width: 150px;
    }

    .side button {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        cursor: pointer;
    }

    .side button:hover {
        background-color: #45a049;
    }

    .tb tr td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        position: relative;
    }
    
    .tb tr td:hover {
        overflow: visible;
    }

    .tb tr td span.tooltip {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        z-index: 100000;
        bottom: 30%;
        left: 0;
        width: max-content;
        
    }

    .tb tr td:hover .tooltip {
        display: block;
        overflow: visible;
    }
    
    .detail {
    	margin-left:20px;
    }
</style>


<div>
     <div class='side' id='<@pageId>_updateItems'>
		<div class='detail' >ROW NO:	<input type='text' name='index' readonly style='width:50px;background-color:#F2F2F2'></div>
		<div class='detail' >MENU ID:	<input type='text' name='MENU_ID' readonly style='width:200px;background-color:#F2F2F2'></div>
		<div class='detail' >MENU NM : 	<input type='text' name='MENU_NM' >                      </div>
		<div class='detail' >PAGE ID: 	<input type='text' name='PAGE_ID' >                      </div>
		<div class='detail' >MENU DESC:	<input type='text' name='MENU_DESC' >                    </div>
		<div class='detail' >USE YN: 	
								<label><input type='radio' name='USE_YN' value="" checked/>ALL</label>
								<label><input type='radio' name='USE_YN' value="Y" />Yes</label>
								<label><input type='radio' name='USE_YN' value="N"  />No</label></div>
		<div class='detail' >PARENT MENU:<select id="PARENT_MENU_ID" name="PARENT_MENU_ID"/>	</div>
		<div class='detail' >MENU DEPTH:<input type='text' name='MENU_DEPTH' readonly style='width:40px;background-color:#F2F2F2'></div> 
		<div class='detail' >SORT ORDER:<input type='text' name='SORT_ORDER' style='width:40px;' oninput="this.value = this.value.replace(/[^0-9]/g, '');"></div>
     </div>
     
     <button id='<@pageId>_insertMenu'	>추가</button>
     <button id='<@pageId>_deleteMenu'	>삭제</button>
     <button id='<@pageId>_saveMenu'	>저장</button>
     <button id='<@pageId>_reset'		>초기화</button>
     <button id='<@pageId>_search'		>조회</button>
     <table class='tb'>
       <thead>
           <tr>
               <th style='width:20px;'>ck</th>
               <th style='width:50px;'>#번호</th>
               <th>MENU_ID</th>
               <th style='width:150px;'>MENU_NM</th>
               <th style='width:150px;'>PARENT_ID</th>
               <th style='width:60px;'>DEPTH</th>
               <th>MENU_DESC</th>
               <th>PAGE_ID</th>
               <th>UPDATE_USER</th>
               <th>UPDATE_DATE</th>
               <th style='width:70px;'>ORDER</th>
               <th style='width:60px;'>USE_YN</th>
           </tr>
       </thead>
       <tbody id="menuList">
       </tbody>
<script type="text/x-jsrender" id="menuList_template">	
				{{for list}}
				<tr id="menuId_{{:#index}}">
 					<td><input type='checkbox' id="<@pageId>.ck_{{:#index}}" value='{{:MENU_ID}}'></td>
 					<td id='index' 			value='{{:#index}}'		>#{{:#index+1}}	</td>
 					<td id='MENU_ID' 		value='{{:MENU_ID}}'	><span  class="tooltip">{{:MENU_ID}}</span>{{:MENU_ID}}</td>
 					<td id='MENU_NM' 		value='{{:MENU_NM}}'	><span  class="tooltip">{{:MENU_NM}}</span>{{:MENU_NM}}	</td>
 					<td id='PARENT_MENU_ID' value='{{:PARENT_MENU_ID}}'><span  class="tooltip">{{:PARENT_MENU_ID}}</span>{{:PARENT_MENU_ID}}</td>
 					<td id='MENU_DEPTH' 	value='{{:MENU_DEPTH}}'	>{{:MENU_DEPTH}}</td>
 					<td id='MENU_DESC' 		value='{{:MENU_DESC}}'	><span  class="tooltip">{{:MENU_DESC}}</span>{{:MENU_DESC}}	</td>
 					<td id='PAGE_ID' 		value='{{:PAGE_ID}}'	><span  class="tooltip">{{:PAGE_ID}}</span>{{:PAGE_ID}}	</td>
 					<td id='UPDATE_USER' 	value='{{:UPDATE_USER}}'>{{:UPDATE_USER}}</td>
 					<td id='UPDATE_DATE' 	value='{{:UPDATE_DATE}}'><span  class="tooltip">{{:UPDATE_DATE}}</span>{{:UPDATE_DATE}}</td>
 					<td id='SORT_ORDER' 	value='{{:SORT_ORDER}}' >{{:SORT_ORDER}}</td>
 					<td id='USE_YN' 		value='{{:USE_YN}}' 	>{{:USE_YN}}</td>
				</tr>
				{{/for}}
</script>
<script type="text/x-jsrender" id="menuList_noData_template">	
				<tr>	
					<td colspan=12>자료가 없습니다.</td>	
				</tr>
</script>
	</table>
</div>