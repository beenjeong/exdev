<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Sample">

	<cache />
	
	<!-- MVT 및 Model의 실제 Data (관련 Table => T_MDL_MODEL_SAVE, T_MDL_MODEL_SAVE_MVT_ITEM) -->
	<select id="getSample" resultType="java.util.HashMap" flushCache="true"  useCache="false">
		SELECT T_CLM 
		FROM TEST 
		WHERE 1 = 1
	</select>

    <insert id="setFile" parameterType="map" useGeneratedKeys="true" keyProperty="userId">
        /* Sample.setFile */
       INSERT INTO TBL_EXP_FILEMNG(
             UUID
            ,GRP_UUID
            ,ORG_FILE_NAME
            ,STORED_FILE_NAME
            ,FILE_PATH
            
            ,FILE_SIZE
            ,FILE_TYPE
            ,ORDER_NUMBER
            ,CREATE_USER
            ,CREATE_DATE
        )
        VALUES(
            #{uuid},
            #{grpUuid},
            #{orgFileName},
            #{storedFileName},
            #{filePath},      
                  
            TO_NUMBER(#{fileSize}),
            #{fileType},
            (SELECT NVL2( MAX(ORDER_NUMBER), MAX(ORDER_NUMBER)+1 ,1 ) AS ORDER_NUMBER FROM   TBL_EXP_FILEMNG WHERE GRP_UUID = #{grpUuid}),
            #{createUser},
            (TO_DATE(#{createDate} , 'yyyy/mm/dd hh24:mi:ss') )
        )
    </insert>
    <!-- 첨부파일 조회 이응규 -->
    <select id="getFile" resultType="java.util.HashMap">
        /* Sample.getFile */
        SELECT UUID      
              ,GRP_UUID       
              ,ORG_FILE_NAME    
              ,STORED_FILE_NAME 
              ,FILE_PATH        
              ,FILE_SIZE        
              ,FILE_TYPE
              ,ORDER_NUMBER        
              ,UPDATE_USER      
              ,UPDATE_DATE      
              ,CREATE_USER      
              ,CREATE_DATE      
        FROM   TBL_EXP_FILEMNG
        WHERE    1 = 1
        <if test="grpUuid != null and grpUuid != '' " >
          AND    GRP_UUID = #{grpUuid}
        </if>
        <if test=" uuid != null and uuid != '' " >
          AND    UUID = #{uuid}
        </if>
        ORDER BY ORDER_NUMBER , CREATE_DATE DESC
    </select>
	
	<!-- 첨부파일 삭제  이응규 -->
    <delete id="deleteFile" parameterType="java.util.HashMap"  >
        /* Sample.deleteFile */
        DELETE FROM TBL_EXP_FILEMNG
        WHERE  1 = 1
        <if test=" grpId != null and grpId != '' " >
          AND    GRP_ID = #{grpId}
        </if>
        <if test=" uuid != null and uuid != '' " >
          AND    UUID = #{uuid}
        </if>
    </delete>
    
    <!-- 게시판 조회 이응규 -->
    <select id="getBoardList" resultType="java.util.HashMap">
        /* Sample.getBoardList */
        SELECT UUID
              ,BOARD_CODE
              ,TITLE
              ,CONTENTS
              ,DELETE_YN
              ,UPDATE_USER
              ,UPDATE_DATE
              ,CREATE_USER
              ,CREATE_DATE
        FROM   TBL_EXP_BOARD
        WHERE  1 = 1
        <if test=" boardCode != null and boardCode != '' " >
          AND    BOARD_CODE = #{boardCode}
        </if><if test=" uuid != null and uuid != '' " >
          AND    UUID = #{uuid}
        </if>
        ORDER BY CREATE_DATE DESC
    </select>

	<!-- Session 테스트 -->
    <select id="getSession" resultType="java.util.HashMap">
    
    	SELECT
    		 #{sessionVo.spCstmId}	AS SP_CSTM_ID
    		,#{sessionVo.userId} 	AS USER_ID
    		,#{sessionVo.userNm} 	AS USER_NM
    	FROM DUAL
	</select>

    
    <insert id="setFileNew" parameterType="java.util.HashMap"  useGeneratedKeys="true" keyProperty="userId">
        /* Sample.setFile */
       INSERT INTO TBL_EXP_FILEMNG_NEW(
             GRP_FILE_ID
            ,FILE_ID
            ,ORG_FILE_NM
            ,STORED_FILE_NM
            ,FILE_PATH
            ,FILE_SIZE
            ,FILE_TYPE
            ,OWNER_CD
            ,ORDER_NUM
            ,DEL_YN
            ,SP_CSTM_ID
            ,CREATE_USER
            ,CREATE_DATE
        )
        VALUES(
             #{GRP_FILE_ID}
            ,#{FILE_ID}
            ,#{ORG_FILE_NM}
            ,#{STORED_FILE_NM}
            ,#{FILE_PATH} 
            ,TO_NUMBER(#{FILE_SIZE})
            ,#{FILE_TYPE}
            ,#{OWNER_CD}
            ,(SELECT NVL2( MAX(ORDER_NUM), MAX(ORDER_NUM)+1 ,1 ) AS ORDER_NUM FROM TBL_EXP_FILEMNG_NEW WHERE GRP_FILE_ID = #{GRP_FILE_ID})
            ,'N'
            ,#{sessionVo.spCstmId}
            ,#{sessionVo.userId}
            ,sysdate
        )
    </insert>

    
</mapper>
