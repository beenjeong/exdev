<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">

	<cache />
	
	<select id="getMenuList" resultType="java.util.HashMap" flushCache="true"  useCache="false">
		/*	admin.getMenuList
			메뉴 리스트 조회 
		*/
		SELECT MENU_ID 
		,MENU_NM,PARENT_MENU_ID,MENU_DEPTH
		,MENU_DESC,PAGE_ID
		,USE_YN
		,UPDATE_USER
		,TO_CHAR( UPDATE_DATE , 'YYYY-MM-DD HH24:MI:SS' ) UPDATE_DATE 
		,SORT_ORDER
		FROM ADMIN.TBL_EXP_MENU T
		WHERE 1 = 1
		<if test=" MENU_NM != null and MENU_NM != '' ">
		AND T.MENU_NM like '%' || #{MENU_NM} || '%'
		</if>
		<if test=" PARENT_MENU_ID != null and PARENT_MENU_ID != '' ">
		AND T.PARENT_MENU_ID like  '%' || #{PARENT_MENU_ID} || '%'
		</if>
		<if test=" MENU_DEPTH != null and MENU_DEPTH != '' ">
		AND T.MENU_DEPTH = #{MENU_DEPTH}
		</if>
		<if test=" MENU_DESC != null and MENU_DESC != '' ">
		AND T.MENU_DESC like '%' || #{MENU_DESC} || '%'
		</if>
		<if test=" PAGE_ID != null and PAGE_ID != '' ">
		AND T.PAGE_ID like '%' || #{PAGE_ID} || '%'
		</if>
		<if test="USE_YN != null">
		AND T.USE_YN = NVL( #{USE_YN}, 'Y')
		</if>
		<if test=" SORT_ORDER != null and SORT_ORDER != '' ">
		AND T.SORT_ORDER = #{SORT_ORDER}
		</if>
		ORDER BY SORT_ORDER
	</select>
	 
	
	<update id="updateMenu" parameterType="java.util.HashMap"  flushCache="true" >
		/*	admin.updateMenu
			메뉴 저장
		*/
		MERGE INTO ADMIN.TBL_EXP_MENU T
		USING (
		  SELECT #{MENU_ID} AS MENU_ID,
		         #{MENU_NM} AS MENU_NM,
		         #{PARENT_MENU_ID} AS PARENT_MENU_ID,
		         #{MENU_DEPTH} AS MENU_DEPTH,
		         #{MENU_DESC} AS MENU_DESC,
		         #{PAGE_ID} AS PAGE_ID,
		        <if test="USE_YN != null">
		         NVL(#{USE_YN},'Y') AS USE_YN,
		        </if>
		        <if test="USE_YN == null">
		         'Y' AS USE_YN,
		        </if>
		        <if test="SORT_ORDER != null">
		         TO_NUMBER(#{SORT_ORDER}) AS SORT_ORDER,
		        </if>
		        <if test="SORT_ORDER == null">
		         100 AS SORT_ORDER,
		        </if>
		         'admin' AS UPDATE_USER,
		         SYSDATE AS UPDATE_DATE
		  FROM dual
		) S
		ON (T.MENU_ID = S.MENU_ID)
		WHEN MATCHED THEN
		  UPDATE SET
		    T.MENU_NM = S.MENU_NM,
		    T.PARENT_MENU_ID = S.PARENT_MENU_ID,
		    T.MENU_DEPTH = S.MENU_DEPTH,
		    T.MENU_DESC = S.MENU_DESC,
		    T.PAGE_ID = S.PAGE_ID,
		    T.USE_YN = S.USE_YN,
		    T.SORT_ORDER = S.SORT_ORDER,
		    T.UPDATE_USER = S.UPDATE_USER,
		    T.UPDATE_DATE = S.UPDATE_DATE
		WHEN NOT MATCHED THEN 
		  INSERT (  MENU_ID,   MENU_NM,   PARENT_MENU_ID,   MENU_DEPTH,   MENU_DESC,   PAGE_ID,   USE_YN,   SORT_ORDER,   UPDATE_USER,   UPDATE_DATE)
		  VALUES (S.MENU_ID, S.MENU_NM, S.PARENT_MENU_ID, S.MENU_DEPTH, S.MENU_DESC, S.PAGE_ID, S.USE_YN, S.SORT_ORDER, S.UPDATE_USER, S.UPDATE_DATE)
	</update>
	
	<delete id="deleteMenu" parameterType="java.util.HashMap"  flushCache="true" >
		/*	admin.deleteMenu
			메뉴 삭제
		*/
		DELETE FROM ADMIN.TBL_EXP_MENU 
		WHERE MENU_ID = #{MENU_ID} 
	</delete>
</mapper>
